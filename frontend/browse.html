<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Browse Songs</title>
  <link rel="stylesheet" href="css/style.css" />
</head>

<body>
  <header>
    <div class="logo-search">
      <img src="img/logo.png" alt="logo" />
      <input type="text" placeholder="Search..." />
    </div>
    <nav>
      <a href="home.html">home</a>
      <a href="about.html">about</a>
      <a href="browse.html">browse</a>
      <a href="tracklist.html" class="my-list">my list</a>
    </nav>
  </header>

  <main class="browse">
    <section class="categories">
      <div class="genre" data-genre="RAP"><img src="img/logo.png" />
        <p>RAP</p>
      </div>
      <div class="genre" data-genre="POP"><img src="img/logo.png" />
        <p>POP</p>
      </div>
      <div class="genre" data-genre="COUNTRY"><img src="img/logo.png" />
        <p>COUNTRY</p>
      </div>
      <div class="genre" data-genre="R&B"><img src="img/logo.png" />
        <p>R&B</p>
      </div>
      <div class="genre" data-genre="EDM"><img src="img/logo.png" />
        <p>EDM</p>
      </div>
      <div class="genre" data-genre="INDIE"><img src="img/logo.png" />
        <p>INDIE</p>
      </div>
    </section>

    <section class="friends">
      <h2>users</h2>
      <div class="friend-list" id="friendList"></div>
    </section>

    <section class="recommended">
      <h2>recommended songs</h2>
      <div class="card-list" id="recommendedSongs"></div>
    </section>
  </main>

  <script>
    // Genre filter redirect
    document.querySelectorAll('.genre').forEach(genreDiv => {
      genreDiv.addEventListener('click', () => {
        const genre = genreDiv.getAttribute('data-genre');
        window.location.href = `genre.html?genre=${encodeURIComponent(genre)}`;

      });
    });

    // Load all users as "friends"
    async function loadUsers() {
      try {
        const res = await fetch('/api/users');
        const users = await res.json();
        const container = document.getElementById('friendList');
        container.innerHTML = '';

        users.forEach(user => {
          const wrapper = document.createElement('div');
          wrapper.style.textAlign = 'center';
          wrapper.style.marginRight = '10px';

          const img = document.createElement('img');
          img.src = user.imageUrl || 'img/logo.png';
          img.alt = user.username;
          img.style.width = '60px';
          img.style.height = '60px';
          img.style.borderRadius = '50%';
          img.style.cursor = 'pointer';
          img.onclick = () => {
            window.location.href = `account.html?userId=${user.id}`;
          };

          const name = document.createElement('p');
          name.textContent = user.username;
          name.style.fontSize = '12px';
          name.style.color = '#f0f0f0';
          name.style.marginTop = '5px';

          wrapper.appendChild(img);
          wrapper.appendChild(name);
          container.appendChild(wrapper);

        });
      } catch (err) {
        console.error('❌ Failed to load users:', err);
      }
    }

    // Load recommended songs
    async function loadRecommendedSongs() {
      try {
        const res = await fetch('/api/songs');
        const songs = await res.json();
        const container = document.getElementById('recommendedSongs');
        container.innerHTML = '';

        songs.slice(0, 4).forEach(song => {
          const card = document.createElement('a');
          card.href = `song.html?songId=${song.id}`;
          card.className = 'card';
          card.innerHTML = `
            <p>${song.title}</p>
            <p>${song.length || 'N/A'}</p>
            <p>★ ★ ★ ☆ ☆</p>
          `;
          container.appendChild(card);
        });
      } catch (err) {
        console.error('❌ Failed to load songs:', err);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadUsers();
      loadRecommendedSongs();
    });
  </script>

  <footer>
    <div class="footer-left">
      <img src="img/logo.png" />
      <p>USA</p>
      <p>© trackstack</p>
    </div>
    <div class="footer-menu"></div>
  </footer>
</body>

</html>